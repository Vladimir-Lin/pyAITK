# -*- coding: utf-8 -*-
##############################################################################
## 即時通
##############################################################################
import os
import sys
##############################################################################
import mysql . connector
from   mysql . connector             import Error
##############################################################################
from   ..      Database . Query      import Query      as Query
from   ..      Database . Connection import Connection as Connection
from   ..      Database . Columns    import Columns    as Columns
##############################################################################
class IMS                ( Columns                                         ) :
  ############################################################################
  def __init__           ( self                                            ) :
    ##########################################################################
    super ( ) . __init__ (                                                   )
    self . Clear         (                                                   )
    ##########################################################################
    return
  ############################################################################
  def __del__            ( self                                            ) :
    return
  ############################################################################
  def Clear          ( self                                                ) :
    ##########################################################################
    self . Columns = [                                                       ]
    self . Id      = -1
    self . Uuid    =  0
    self . Used    =  1
    self . ImApp   =  0
    self . Account =  0
    self . ltime   =  False
    ##########################################################################
    return
  ############################################################################
  def assign             ( self , item                                     ) :
    ##########################################################################
    self . Columns = item . Columns
    self . Id      = item . Id
    self . Uuid    = item . Uuid
    self . Used    = item . Used
    self . ImApp   = item . ImApp
    self . Account = item . Account
    self . ltime   = item . ltime
    ##########################################################################
    return
  ############################################################################
  def set                  ( self , item , value                           ) :
    ##########################################################################
    a      = item . lower  (                                                 )
    ##########################################################################
    if                     ( "id"      == a                                ) :
      self . Id      = int ( value                                           )
    if                     ( "uuid"    == a                                ) :
      self . Uuid    = int ( value                                           )
    if                     ( "used"    == a                                ) :
      self . Used    = int ( value                                           )
    if                     ( "imapp"   == a                                ) :
      self . ImApp   = int ( value                                           )
    if                     ( "account" == a                                ) :
      self . Account = str ( value                                           )
    if                     ( "ltime"   == a                                ) :
      self . ltime   = value
    ##########################################################################
    return
  ############################################################################
  def get                  ( self , item                                   ) :
    ##########################################################################
    a      = item . lower  (                                                 )
    ##########################################################################
    if                     ( "id"      == a                                ) :
      return self . Id
    if                     ( "uuid"    == a                                ) :
      return self . Uuid
    if                     ( "used"    == a                                ) :
      return self . Used
    if                     ( "imapp"   == a                                ) :
      return self . ImApp
    if                     ( "account" == a                                ) :
      return self . Account
    if                     ( "ltime"   == a                                ) :
      return self . ltime
    ##########################################################################
    return ""
  ############################################################################
  def tableItems ( self                                                    ) :
    return       [ "id"                                                    , \
                   "uuid"                                                  , \
                   "used"                                                  , \
                   "imapp"                                                 , \
                   "account"                                               , \
                   "ltime"                                                   ]
  ############################################################################
  def pair                ( self , item                                    ) :
    ##########################################################################
    a      = item . lower (                                                  )
    v      = self . get   ( item                                             )
    ##########################################################################
    if                    ( "id"      == a                                 ) :
      return f"`{item}` = {v}"
    if                    ( "uuid"    == a                                 ) :
      return f"`{item}` = {v}"
    if                    ( "used"    == a                                 ) :
      return f"`{item}` = {v}"
    if                    ( "imapp"   == a                                 ) :
      return f"`{item}` = {v}"
    if                    ( "account" == a                                 ) :
      return f"`{item}` = '{v}'"
    if                    ( "ltime"   == a                                 ) :
      return f"`{item}` = '{v}'"
    ##########################################################################
    return f"`{item}` = {v}"
  ############################################################################
  def valueItems ( self                                                    ) :
    return       [ "used"                                                  , \
                   "imapp"                                                 , \
                   "account"                                                 ]
  ############################################################################
  def toJson ( self                                                        ) :
    return   { "id"      : self . Id                                       , \
               "uuid"    : self . Uuid                                     , \
               "used"    : self . Used                                     , \
               "imapp"   : self . ImApp                                    , \
               "account" : self . Account                                  , \
               "ltime"   : self . Update                                     }
  ############################################################################
  def setImApp ( self , imapp                                              ) :
    ##########################################################################
    self . ImApp = imapp
    ##########################################################################
    return
  ############################################################################
  def hasSpecialChar ( self , MSG                                          ) :
    ##########################################################################
    KEYs =           [ "@"                                                 , \
                       " "                                                 , \
                       "'"                                                 , \
                       "\""                                                , \
                       "%"                                                 , \
                       "`"                                                 , \
                       "/"                                                 , \
                       "\\"                                                  ]
    for K in KEYs                                                            :
      if             ( K in MSG                                            ) :
        return True
    ##########################################################################
    return False
  ############################################################################
  def setAccount             ( self , account                              ) :
    ##########################################################################
    if                       ( not self . hasSpecialChar  ( account  )     ) :
      return False
    ##########################################################################
    self . Account = account
    ##########################################################################
    return True
##############################################################################
