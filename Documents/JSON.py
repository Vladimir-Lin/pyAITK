# -*- coding: utf-8 -*-
##############################################################################
## JSON工具程式
##############################################################################
import os
import sys
import time
import datetime
import base64
import json
##############################################################################
## 從檔案中載入JSON
##############################################################################
def Load                     ( Filename                                    ) :
  ############################################################################
  if                         ( not os . path . isfile ( Filename )         ) :
    return                   {                                               }
  ############################################################################
  TEXT     = ""
  with open                  ( Filename , "rb" ) as jsonFile                 :
    TEXT   = jsonFile . read (                                               )
  ############################################################################
  if                         ( len ( TEXT ) <= 0                           ) :
    return                   {                                               }
  ############################################################################
  BODY     = TEXT . decode   ( "utf-8"                                       )
  if                         ( len ( BODY ) <= 0                           ) :
    return                   {                                               }
  ############################################################################
  return json . loads        ( BODY                                          )
##############################################################################
## 儲存JSON到檔案中
##############################################################################
def Save              ( Filename , Main                                    ) :
  with open           ( Filename , 'w' , encoding = "utf-8" ) as f           :
    json . dump       ( Main , f , ensure_ascii = False , indent = 4         )
  return True
##############################################################################
## 合併兩個JSON
##############################################################################
def Merge                    ( Main , After , Ignore = [ ]                 ) :
  ############################################################################
  if                         ( len ( After ) <= 0                          ) :
    return Main
  ############################################################################
  KEYs = After . keys        (                                               )
  if                         ( len ( KEYs ) <= 0                           ) :
    return Main
  ############################################################################
  for k in KEYs                                                              :
    if                       ( k not in Ignore                             ) :
      Main [ k ] = After [ k ]
  ############################################################################
  return Main
##############################################################################
## 載入兩個JSON，並且進行合併
##############################################################################
def LoadBoth                 ( MainFile , AfterFile , Ignore = [ ]         ) :
  ############################################################################
  MainJson  = Load           ( MainFile                                      )
  AfterJson = Load           ( AfterFile                                     )
  ############################################################################
  return Merge               ( MainJson , AfterJson , Ignore                 )
##############################################################################
## JSON轉換到BASE64
##############################################################################
def JsonToBase64              ( J                                          ) :
  ############################################################################
  JMSG   = json   . dumps     ( J                                            )
  BMSG   = JMSG   . encode    ( "utf-8"                                      )
  JBYTEs = base64 . b64encode ( BMSG                                         )
  ABYTEs = JBYTEs . decode    ( "ascii"                                      )
  ############################################################################
  return ABYTEs
##############################################################################
## BASE64轉換到JSON
##############################################################################
def JsonFromBase64           ( B                                           ) :
  ############################################################################
  BFI   = B      . encode    ( "ascii"                                       )
  DFI   = base64 . b64decode ( BFI                                           )
  ZFI   = DFI    . decode    ( "utf-8"                                       )
  ############################################################################
  try                                                                        :
    ##########################################################################
    JFI = json   . loads     ( ZFI                                           )
    ##########################################################################
  except                                                                     :
    ##########################################################################
    return                   {                                               }
  ############################################################################
  return JFI
##############################################################################
