# -*- coding: utf-8 -*-
##############################################################################
## YUVi
## YUV顏色模型 0~255整數值域
##############################################################################
import cv2
import numpy as np
import colour
from . CommonColor import CommonColor
from . RGBi        import RGBi
##############################################################################
class YUVi                  ( CommonColor                                  ) :
  ############################################################################
  def __init__              ( self                                         ) :
    ##########################################################################
    self . ColorModel = "YUV"
    self . ValueType  = "UInt8"
    ##########################################################################
    self . Y          = int ( 0                                              )
    self . U          = int ( 0                                              )
    self . V          = int ( 0                                              )
    ##########################################################################
    return
  ############################################################################
  def __del__    ( self                                                    ) :
    ##########################################################################
    ##########################################################################
    return
  ############################################################################
  ## 轉成JSON格式
  ############################################################################
  def toJson ( self                                                        ) :
    return   { "Model" : "YUV"                                             , \
               "Value" : "UInt8"                                           , \
               "Y"     : self . Y                                          , \
               "U"     : self . U                                          , \
               "V"     : self . V                                            }
  ############################################################################
  ## 從JSON格式轉換顏色模型
  ############################################################################
  def fromJson     ( self , JSON                                           ) :
    ##########################################################################
    KEYs =         [ "Model" , "Value" , "Y" , "U" , "V"                     ]
    ##########################################################################
    for K in KEYs                                                            :
      if           ( K not in JSON                                         ) :
        return False
    ##########################################################################
    if             ( "YUV"   != JSON [ "Model" ]                           ) :
      return   False
    ##########################################################################
    if             ( "UInt8" != JSON [ "Value" ]                           ) :
      return   False
    ##########################################################################
    self . Y = int ( JSON [ "Y" ]                                            )
    self . U = int ( JSON [ "U" ]                                            )
    self . V = int ( JSON [ "V" ]                                            )
    ##########################################################################
    return     True
  ############################################################################
  def fromYUVf                        ( self , fYUV                        ) :
    ##########################################################################
    self . Y = self . ConstraintUInt8 (        fYUV . Y * 255.0              )
    self . U = self . ConstraintUInt8 (        fYUV . U * 255.0              )
    self . V = self . ConstraintUInt8 (        fYUV . V * 255.0              )
    ##########################################################################
    return
  ############################################################################
  def fromRGBi                 ( self , iRGB                               ) :
    ##########################################################################
    M        = cv2  . cvtColor ( iRGB . toNpBGR ( ) , cv2 . COLOR_BGR2YUV    )
    ##########################################################################
    self . Y = int             ( M [ 0 ] [ 0 ] [ 0                         ] )
    self . U = int             ( M [ 0 ] [ 0 ] [ 1                         ] )
    self . V = int             ( M [ 0 ] [ 0 ] [ 2                         ] )
    ##########################################################################
    return True
  ############################################################################
  def toYUV ( self                                                         ) :
    return  [ self . H , self . S , self . V                                 ]
  ############################################################################
  def toNpYUV         ( self                                               ) :
    return np . array ( [ [ self . toYUV ( ) ] ] , dtype = np . uint8        )
  ############################################################################
  def toRGBi           ( self                                              ) :
    ##########################################################################
    M = cv2 . cvtColor ( self . toNpYUV ( ) , cv2 . COLOR_YUV2BGR            )
    ##########################################################################
    B = int            ( M [ 0 ] [ 0 ] [ 0                                 ] )
    G = int            ( M [ 0 ] [ 0 ] [ 1                                 ] )
    R = int            ( M [ 0 ] [ 0 ] [ 2                                 ] )
    ##########################################################################
    return RGBi        ( R , G , B                                           )
  ############################################################################
  def fromCvYUV    ( self , YUV                                            ) :
    ##########################################################################
    self . Y = int ( YUV [ 0 ]                                               )
    self . U = int ( YUV [ 1 ]                                               )
    self . V = int ( YUV [ 2 ]                                               )
    ##########################################################################
    return
  ############################################################################
  def Distance          ( self ,                       C                   ) :
    ##########################################################################
    NP = self . toNpYUV (                                                    )
    ##########################################################################
    return np . sqrt    ( np . sum ( ( NP [ 0 ][ 0 ] - C ) ** 2            ) )
##############################################################################
